import{j as e}from"./ui-B6UisXh3.js";import{e as a,r as t}from"./router-DECodpxX.js";import{e as s}from"./countries-CY_OT5aH.js";import{d as r}from"./index-CCZHs8x9.js";import"./vendor-DEQ385Nk.js";import"./three-CdCYxwFx.js";import"./supabase-Bj79fh9f.js";import"./utils-BpqZfnrR.js";const i=()=>{const i=a(),[n,c]=t.useState([]),[l,d]=t.useState([]),[o,m]=t.useState([]),[p,x]=t.useState(!0),[u,h]=t.useState(!1),[g,y]=t.useState(!1),[b,f]=t.useState(""),[w,j]=t.useState(!1),[k,N]=t.useState(null),[v,_]=t.useState(""),[C,S]=t.useState([]),[I,P]=t.useState(1),[D,A]=t.useState(1),[F,$]=t.useState(0),[B]=t.useState(50),[O,M]=t.useState(""),E=Array.from(new Set(o.map(e=>e.country||e.country_name).filter(Boolean))).sort(),U=O?o.filter(e=>(e.country||e.country_name)===O):o,[R,L]=t.useState(null),[T,G]=t.useState(null),[K,J]=t.useState({}),[q,z]=t.useState(!1),[V,H]=t.useState(!1),[Q,W]=t.useState({totalPackages:0,duplicateIds:{},duplicateCombinations:{},hasDuplicates:!1}),[X,Y]=t.useState(""),[Z,ee]=t.useState(""),[ae,te]=t.useState("myPackages"),se=()=>({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("admin_token")}`}),re=e=>401===e.status&&(localStorage.removeItem("admin_token"),r.error("Session expired. Please login again.",{style:{color:"black"}}),i("/admin/login"),!0);t.useEffect(()=>{ie()},[]),t.useEffect(()=>{ne()},[v,I]);const ie=async()=>{try{const e=await fetch("undefined/api/admin/package-countries",{headers:se()});if(e.ok){const a=await e.json();if("success"===a.status&&Array.isArray(a.data))S(a.data);else{const e=s.map(e=>e.name.en);S(e)}}else{if(re(e))return;const a=s.map(e=>e.name.en);S(a)}}catch(e){const a=s.map(e=>e.name.en);S(a)}},ne=async()=>{try{x(!0),await Promise.all([ce(),le(),de(1,5e4),ie()])}catch(e){f("Failed to fetch data")}finally{x(!1)}},ce=async()=>{try{x(!0);const e=await fetch("undefined/api/admin/my-packages",{headers:se()});if(e.ok){const a=await e.json();c(a.data||a),A(1)}else{if(re(e))return;await e.text();f("Failed to fetch my packages")}}catch(e){f("Failed to fetch my packages")}finally{x(!1)}},le=async()=>{try{h(!0);const e=await fetch("undefined/api/admin/packages",{headers:se()});if(e.ok){const a=await e.json();d(a.data||a),A(1)}else{if(re(e))return;await e.text();f("Failed to fetch main packages")}}catch(e){f("Failed to fetch main packages")}finally{h(!1)}},de=async(e=1,a=5e4)=>{try{y(!0);const e=`undefined/api/admin/all-roamify-packages?page=1&limit=${a}`,t=await fetch(e,{headers:se()});if(t.ok){const e=await t.json();let a=[],s=null;if(e&&"object"==typeof e)if(Array.isArray(e))a=e;else{if(!e.data||!Array.isArray(e.data))return void f("Invalid response format from server");a=e.data,s=e.pagination}s&&(P(s.page),A(s.totalPages),$(s.totalCount));const r=oe(a);W(r),r.hasDuplicates&&(Object.entries(r.duplicateIds).forEach(([e,a])=>{}),Object.entries(r.duplicateCombinations).forEach(([e,a])=>{})),m(a)}else{if(re(t))return;const e=await t.text();f(`Failed to fetch Roamify packages: ${t.status} - ${e.substring(0,200)}`)}}catch(t){f("Failed to fetch Roamify packages")}finally{y(!1)}},oe=e=>{if(!Array.isArray(e))return{totalPackages:0,duplicateIds:{},duplicateCombinations:{},hasDuplicates:!1};const a=e.length,t={},s={},r={};e.forEach(e=>{const a=e.id||e.packageId||"unknown";r[a]||(r[a]=[]),r[a].push(e)}),Object.entries(r).forEach(([e,a])=>{a.length>1&&(t[e]=a)});const i={};e.forEach(e=>{const a=`${e.country||e.country_name||"unknown"}|${e.data||e.dataAmount||"unknown"}|${e.days||e.day||"unknown"}|${e.price||e.base_price||"unknown"}`;i[a]||(i[a]=[]),i[a].push(e)}),Object.entries(i).forEach(([e,a])=>{a.length>1&&(s[e]=a)});const n=Object.keys(t).length>0||Object.keys(s).length>0;return{totalPackages:a,duplicateIds:t,duplicateCombinations:s,hasDuplicates:n}},me=async e=>{var a;N(e.id||e.packageId||"");try{const t=e.description||e.packageName||e.name||e.package||"Unknown Package",s=e.country||e.country_name||"",i=e.country_code||"";let n=e.data||e.dataAmount||"",c=0;if("number"==typeof n)c="MB"===e.dataUnit?n/1024:n;else if("string"==typeof n){const e=n.match(/(\d+(?:\.\d+)?)(GB|MB|KB)?/i);if(e){let t=parseFloat(e[1]);const s=(null==(a=e[2])?void 0:a.toUpperCase())||"GB";c="GB"===s?t:"MB"===s?t/1024:"KB"===s?t/1024/1024:t}}const l=e.days||e.day||0,d=e.price||e.base_price||0,o=K[e.id||e.packageId||""]??d.toString(),m=""===o?d:parseFloat(o),p=e.id||e.packageId||"",x=e.region||"";if(!(t&&s&&i&&c&&l&&d))return r.error("Cannot save: Missing required fields.",{style:{color:"black"}}),f("Cannot save: Missing required fields."),void N(null);const u={name:t,country_name:s,country_code:i,data_amount:c,days:l,base_price:d,sale_price:m,profit:m-d,reseller_id:null,region:x,show_on_frontend:!0,location_slug:"Europe & United States"===s?"":i.toLowerCase(),homepage_order:0,features:{packageId:p,dataAmount:c,days:l,price:d,currency:"EUR",plan:"data-only",activation:"first-use",realRoamifyPackageId:p}},h=await fetch("undefined/api/admin/save-package",{method:"POST",headers:se(),body:JSON.stringify(u)});if(h.ok)await ce(),f(""),r.success('Package saved successfully! Use "Save as Most Popular" to show in Most Popular section.',{style:{color:"black"}});else{if(re(h))return;const e=`Failed to save package: ${(await h.json()).error||"Unknown error"}`;r.error(e,{style:{color:"black"}}),f(e)}}catch(t){const e="Failed to save package";r.error(e,{style:{color:"black"}}),f(e)}finally{N(null)}};return e.jsx("div",{className:"min-h-screen bg-[#4B0082] text-white",children:e.jsxs("div",{className:"max-w-full mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("header",{className:"glass-medium p-4 flex justify-between items-center rounded-b-2xl mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-200",children:"eSIM Package Management"})]}),e.jsx("button",{onClick:()=>{localStorage.removeItem("admin_token"),r.success("Logged out successfully",{style:{color:"black"}}),i("/admin/login")},className:"btn-glass bg-accent text-black px-4 py-2 rounded-xl",children:"Logout"})]}),b&&e.jsx("div",{className:"modal-glass p-4 rounded-2xl max-w-lg mx-auto mb-4 text-red-600 border border-red-400 bg-white",children:b}),e.jsxs("div",{className:"glass-light p-1 rounded-2xl mb-6 inline-flex",children:[e.jsxs("button",{onClick:()=>te("myPackages"),className:"px-6 py-3 rounded-xl font-medium transition-all "+("myPackages"===ae?"bg-white/20 text-white shadow-lg":"text-gray-300 hover:text-white hover:bg-white/10"),children:["My eSIM Packages (",n.length,")"]}),e.jsxs("button",{onClick:()=>te("roamifyPackages"),className:"px-6 py-3 rounded-xl font-medium transition-all "+("roamifyPackages"===ae?"bg-white/20 text-white shadow-lg":"text-gray-300 hover:text-white hover:bg-white/10"),children:["Roamify Packages (",o.length,")"]})]}),e.jsxs("div",{className:"w-full",children:["myPackages"===ae&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"glass-light p-6 rounded-2xl shadow-none mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["My eSIM Packages Only (",n.length,")"]}),e.jsx("p",{className:"text-gray-200 mb-4",children:"Manage your eSIM packages with edit and delete functionality"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"my-packages-country-search",className:"block text-sm font-medium text-white",children:"Search by Country:"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("input",{type:"text",id:"my-packages-country-search",placeholder:"Search country...",value:X,onChange:e=>Y(e.target.value),className:"input-glass w-full text-white placeholder-gray-300"}),X&&e.jsx("button",{onClick:()=>Y(""),className:"btn-glass bg-white/20 text-white px-4 py-2 rounded-xl",children:"Clear"})]}),X&&e.jsxs("p",{className:"mt-1 text-sm text-gray-200",children:["Showing ",n.filter(e=>e.country_name.toLowerCase().includes(X.toLowerCase())).length," of ",n.length," packages"]})]}),p?e.jsx("div",{className:"text-center text-xl",children:"Loading packages..."}):e.jsx("div",{className:"glass p-4 rounded-2xl bg-black/20 w-full",children:e.jsx("div",{className:"overflow-auto max-h-[70vh]",children:e.jsxs("table",{className:"w-full text-left text-white bg-transparent table-auto",children:[e.jsx("thead",{className:"sticky top-0 bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[200px]",children:"Package"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[120px]",children:"Country"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Code"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Data"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[60px]",children:"Days"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Base Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Sale Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[70px]",children:"Profit"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[120px]",children:"Actions"})]})}),e.jsx("tbody",{children:n.filter(e=>!X||e.country_name.toLowerCase().includes(X.toLowerCase())).map(a=>e.jsxs("tr",{className:"hover:bg-white/5 border-b border-white/10 text-white",children:[e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap",children:[(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"text",value:R.name,onChange:e=>L({...R,name:e.target.value}),className:"w-48 px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white"}):e.jsx("div",{className:"text-sm font-medium text-white",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["ID: ",a.id]})]}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"text",value:R.country_name,onChange:e=>L({...R,country_name:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white"}):e.jsx("span",{className:"text-sm text-white",children:a.country_name})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"text",value:R.country_code||"",onChange:e=>L({...R,country_code:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white",placeholder:"e.g., DE"}):e.jsx("span",{className:"text-sm text-white",children:a.country_code||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"number",step:"0.1",value:R.data_amount.toFixed(1),onChange:e=>L({...R,data_amount:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white",placeholder:"GB"}):e.jsxs("span",{className:"text-sm text-white",children:["number"!=typeof a.data_amount||isNaN(a.data_amount)?"0.0":a.data_amount.toFixed(1)," GB"]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"number",value:R.days,onChange:e=>L({...R,days:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-black bg-white"}):e.jsx("span",{className:"text-sm text-white",children:a.days})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"number",step:"0.01",value:R.base_price,onChange:e=>L({...R,base_price:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-black bg-white"}):e.jsxs("span",{className:"text-sm text-white",children:["$",a.base_price]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"number",step:"0.01",value:R.sale_price,onChange:e=>L({...R,sale_price:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm font-bold text-black bg-white"}):e.jsx("input",{type:"number",step:"0.01",value:a.sale_price,onChange:e=>((e,a)=>{const t=parseFloat(a)||0;c(a=>a.map(a=>a.id===e?{...a,sale_price:t,profit:t-a.base_price}:a))})(a.id,e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm font-bold text-black bg-white"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==R?void 0:R.id)===a.id?e.jsx("input",{type:"number",step:"0.01",value:R.profit,readOnly:!0,className:"w-full px-2 py-1 border border-gray-300 rounded text-sm bg-gray-100 text-black"}):e.jsxs("span",{className:"text-sm "+(a.profit>0?"text-green-400":"text-red-400"),children:["$","number"!=typeof a.profit||isNaN(a.profit)?"0.00":a.profit.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium",children:(null==R?void 0:R.id)===a.id?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{j(!0);try{const a={...e,data_amount:e.data_amount},t=await fetch(`undefined/api/admin/update-package/${e.id}`,{method:"PUT",headers:se(),body:JSON.stringify(a)});if(t.ok)await ce(),L(null),f("");else{if(re(t))return;const e=await t.json();f(`Failed to save package: ${e.error||"Unknown error"}`)}}catch(a){f("Failed to save package")}finally{j(!1)}})(R),disabled:w,className:"text-blue-400 hover:text-blue-300 disabled:opacity-50",children:w?"Saving...":"Save"}),e.jsx("button",{onClick:()=>L(null),className:"text-gray-400 hover:text-gray-300",children:"Cancel"})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{L(e)})(a),className:"text-blue-400 hover:text-blue-300",children:"Edit"}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this package?")){G(e);try{const a=await fetch(`undefined/api/admin/delete-package/${e}`,{method:"DELETE",headers:se()});if(a.ok)await ce(),f("");else{if(re(a))return;await a.text(),f("Failed to delete package")}}catch(a){f("Failed to delete package")}finally{G(null)}}})(a.id),disabled:T===a.id,className:"text-red-400 hover:text-red-300 disabled:opacity-50",children:T===a.id?"Deleting...":"Delete"})]})})]},a.id))})]})})})]})}),"roamifyPackages"===ae&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"glass-light p-6 rounded-2xl shadow-none mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["Roamify Packages (",o.length,")"]}),e.jsx("p",{className:"text-gray-200 mb-4",children:"Available packages from Roamify API - Edit sale price and save to your inventory"}),!g&&e.jsxs("div",{className:"mb-4 p-4 bg-white/10 rounded-lg border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-2",children:"Package Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Total Packages"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Q.totalPackages})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Duplicate IDs"}),e.jsx("div",{className:"text-2xl font-bold "+(Q.hasDuplicates?"text-red-600":"text-green-600"),children:Object.keys(Q.duplicateIds).length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Duplicate Combinations"}),e.jsx("div",{className:"text-2xl font-bold "+(Q.hasDuplicates?"text-red-600":"text-green-600"),children:Object.keys(Q.duplicateCombinations).length})]})]}),Q.hasDuplicates&&e.jsx("div",{className:"mt-4",children:e.jsxs("details",{className:"bg-white p-3 rounded border",children:[e.jsx("summary",{className:"cursor-pointer font-medium text-red-700 hover:text-red-800",children:"ðŸ” View Duplicate Details (Click to expand)"}),e.jsxs("div",{className:"mt-3 space-y-4",children:[Object.keys(Q.duplicateIds).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Duplicate IDs:"}),e.jsx("div",{className:"space-y-2",children:Object.entries(Q.duplicateIds).map(([a,t])=>e.jsxs("div",{className:"bg-red-50 p-2 rounded border-l-4 border-red-400",children:[e.jsxs("div",{className:"font-medium text-red-800",children:["ID: ",a," (appears ",t.length," times)"]}),t.map((a,t)=>e.jsxs("div",{className:"text-sm text-red-700 ml-4",children:[t+1,". ",a.description||a.packageName||a.name||a.package," - ",a.country||a.country_name," - ",a.data_amount||a.dataAmount||a.data," - ",a.days||a.day," days - $",a.base_price||a.price]},t))]},a))})]}),Object.keys(Q.duplicateCombinations).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Duplicate Combinations (Country + Data + Days + Price):"}),e.jsx("div",{className:"space-y-2",children:Object.entries(Q.duplicateCombinations).map(([a,t])=>e.jsxs("div",{className:"bg-orange-50 p-2 rounded border-l-4 border-orange-400",children:[e.jsxs("div",{className:"font-medium text-orange-800",children:["Combination: ",a," (appears ",t.length," times)"]}),t.map((a,t)=>e.jsxs("div",{className:"text-sm text-orange-700 ml-4",children:[t+1,". ID: ",a.id||a.packageId," - ",a.description||a.packageName||a.name||a.package]},t))]},a))})]})]})]})})]}),!g&&Q.hasDuplicates&&e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"ðŸ“‹ Duplicate Indicators Legend:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-50 border-l-4 border-red-400 mr-2"}),e.jsx("span",{className:"text-yellow-700",children:"Red background = Duplicate package"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mr-2",children:"Duplicate ID"}),e.jsx("span",{className:"text-yellow-700",children:"Same package ID appears multiple times"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mr-2",children:"Duplicate Combo"}),e.jsx("span",{className:"text-yellow-700",children:"Same country + data + days + price combination"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"country-filter",className:"block text-sm font-medium text-white",children:"Filter by Country:"}),e.jsx("input",{type:"text",placeholder:"Search country...",value:Z,onChange:e=>ee(e.target.value),className:"mt-1 mb-2 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md text-gray-900 bg-white"}),e.jsxs("select",{id:"country-filter",value:O,onChange:e=>M(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md text-gray-900 bg-white",children:[e.jsxs("option",{value:"",children:["All Countries (",E.length,")"]}),E.filter(e=>!!e&&e.toLowerCase().includes(Z.toLowerCase())).map(a=>e.jsx("option",{value:a,children:a},a))]})]}),!g&&Q.hasDuplicates&&e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:async()=>{if(Q.hasDuplicates){z(!0);try{const e=await fetch("undefined/api/admin/deduplicate-packages",{method:"POST",headers:se()});if(e.ok){const a=await e.json();r.success(`Successfully removed ${a.removedCount} duplicate packages`,{style:{color:"black"}}),await de()}else{if(re(e))return;const a=await e.json();r.error(`Failed to remove duplicates: ${a.error||"Unknown error"}`,{style:{color:"black"}})}}catch(e){r.error("Failed to remove duplicates",{style:{color:"black"}})}finally{z(!1)}}else r.info("No duplicates found to remove",{style:{color:"black"}})},disabled:q,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Removing Duplicates..."]}):e.jsxs(e.Fragment,{children:["ðŸ—‘ï¸ Remove Duplicates",e.jsxs("span",{className:"text-xs bg-red-700 px-2 py-1 rounded",children:[Object.keys(Q.duplicateIds).length+Object.keys(Q.duplicateCombinations).length," groups"]})]})}),e.jsx("p",{className:"mt-1 text-sm text-gray-300",children:"This will remove duplicate packages based on ID and combination matches"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:async()=>{H(!0);try{const e=await fetch("undefined/api/sync/roamify-packages",{method:"POST",headers:se()});if(e.ok){const a=await e.json();r.success(`Successfully synced ${a.syncedCount} packages from Roamify API (${a.countries} countries)`,{style:{color:"black"}}),await de()}else{if(re(e))return;const a=await e.json();r.error(`Failed to sync packages: ${a.message||"Unknown error"}`,{style:{color:"black"}})}}catch(e){r.error("Failed to sync packages",{style:{color:"black"}})}finally{H(!1)}},disabled:V,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:V?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Syncing from Roamify API..."]}):e.jsx(e.Fragment,{children:"ðŸ”„ Sync from Roamify API"})}),e.jsx("p",{className:"mt-1 text-sm text-gray-300",children:"This will fetch fresh data directly from Roamify API and sync to database"})]}),g?e.jsx("div",{className:"text-center text-xl text-white mt-8",children:"Loading Roamify packages..."}):0===o.length?e.jsxs("div",{className:"text-center text-xl text-white mt-8",children:[e.jsx("p",{children:"No packages loaded from database."}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:'Click "Sync from Roamify API" to fetch packages.'})]}):0===U.length?e.jsxs("div",{className:"text-center text-xl text-white mt-8",children:[e.jsxs("p",{children:['No packages found for country: "',O,'"']}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:'Try selecting "All Countries" or a different country.'})]}):e.jsx("div",{className:"glass p-4 rounded-2xl bg-black/20 mt-6 w-full",children:e.jsx("div",{className:"overflow-auto max-h-[70vh]",children:e.jsxs("table",{className:"w-full text-left text-white bg-transparent table-auto",children:[e.jsx("thead",{className:"sticky top-0 bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[200px]",children:"Package"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[120px]",children:"Country"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Code"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Data"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[60px]",children:"Days"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Base Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Sale Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[70px]",children:"Profit"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[150px]",children:"Actions"})]})}),e.jsx("tbody",{children:U.map(a=>{const t=Q.duplicateIds[a.id||a.packageId||""],s=`${a.country||a.country_name||"unknown"}|${a.data||a.dataAmount||"unknown"}|${a.days||a.day||"unknown"}|${a.price||a.base_price||"unknown"}`,i=Q.duplicateCombinations[s];return e.jsxs("tr",{className:"hover:bg-white/5 border-b border-white/10 text-white "+(t||i?"bg-red-900/20":""),children:[e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:a.description||a.packageName||a.name||a.package||"Unknown Package"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["ID: ",a.id||a.packageId||"N/A"]}),t&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mt-1",children:"Duplicate ID"}),i&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800 mt-1",children:"Duplicate Combo"})]}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:a.country||a.country_name||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:a.country_code||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm text-white",children:[a.data||("number"==typeof a.dataAmount?a.dataAmount.toFixed(1):"N/A")," GB"]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:a.days||a.day||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm text-white",children:["$",a.price||a.base_price||"0.00"]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",step:"0.01",value:K[a.id||a.packageId||""]||"",onChange:e=>J(t=>({...t,[a.id||a.packageId||""]:e.target.value})),placeholder:(a.price||a.base_price||0).toString(),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm font-bold text-black bg-white"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm "+(parseFloat(K[a.id||a.packageId||""]||"0")-(a.price||a.base_price||0)>0?"text-green-400":"text-red-400"),children:["$",((parseFloat(K[a.id||a.packageId||""]||"0")||a.price||a.base_price||0)-(a.price||a.base_price||0)).toFixed(2)]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>me(a),disabled:k===(a.id||a.packageId),className:"text-blue-400 hover:text-blue-300 disabled:opacity-50",children:k===(a.id||a.packageId)?"Saving...":"Save"}),e.jsx("button",{onClick:()=>(async e=>{var a;N(e.id||e.packageId||"");try{if("Europe & United States"!==e.country)return r.error("Only Europe & United States packages can be saved as Most Popular. This package will be saved to its country-specific page instead.",{style:{color:"black"}}),void(await me(e));const t=e.price||e.base_price||0,s=K[e.id||e.packageId||""]??t.toString(),i=""===s?t:parseFloat(s);let n=e.data||e.dataAmount||"",c=0;if("number"==typeof n)c="MB"===e.dataUnit?n/1024:n;else if("string"==typeof n){const e=n.match(/(\d+(?:\.\d+)?)(GB|MB|KB)?/i);if(e){let t=parseFloat(e[1]);const s=(null==(a=e[2])?void 0:a.toUpperCase())||"GB";c="GB"===s?t:"MB"===s?t/1024:"KB"===s?t/1024/1024:t}}const l={name:e.description||e.packageName||e.name||e.package||"Unknown Package",country_name:e.country||e.country_name||"",country_code:e.country_code||"",data_amount:c,days:e.days||e.day||0,base_price:t,sale_price:i,profit:i-t,reseller_id:null,region:e.region||"",show_on_frontend:!0,location_slug:"most-popular",homepage_order:1,features:{packageId:e.id||e.packageId||"",dataAmount:c,days:e.days||e.day||0,price:t,currency:"EUR",plan:"data-only",activation:"first-use",realRoamifyPackageId:e.id||e.packageId||""}},d=await fetch("undefined/api/admin/save-package",{method:"POST",headers:se(),body:JSON.stringify(l)});if(d.ok)await ce(),f(""),r.success("Package saved to Most Popular section successfully!",{style:{color:"black"}});else{if(re(d))return;const e=`Failed to save package: ${(await d.json()).error||"Unknown error"}`;r.error(e,{style:{color:"black"}}),f(e)}}catch(t){const e="Failed to save package";r.error(e,{style:{color:"black"}}),f(e)}finally{N(null)}})(a),disabled:k===(a.id||a.packageId),className:"text-green-400 hover:text-green-300 disabled:opacity-50",children:"Save as Most Popular"})]})})]},a.id||a.packageId)})})]})})})]})})]})]})})};export{i as default};
