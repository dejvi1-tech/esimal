import{j as e}from"./ui-B6UisXh3.js";import{e as a,r as t}from"./router-DECodpxX.js";import{u as s,g as r,d as i}from"./index-C7QPt96S.js";import"./vendor-DEQ385Nk.js";import"./three-CdCYxwFx.js";import"./supabase-Bj79fh9f.js";import"./utils-BpqZfnrR.js";const c=()=>{const{t:c}=s(),l=a(),[n,d]=t.useState([]),[o,p]=t.useState([]),[m,x]=t.useState(!0),[u,h]=t.useState(!1),[g,y]=t.useState(""),[b,w]=t.useState(!1),[f,j]=t.useState(null),[k,N]=t.useState(1),[v,_]=t.useState(""),C=Array.from(new Set(o.map(e=>e.country||e.country_name).filter(Boolean))).sort(),P=v?o.filter(e=>(e.country||e.country_name)===v):o,[S,I]=t.useState(null),[D,A]=t.useState(null),[F,O]=t.useState({}),[$,E]=t.useState(!1),[B,M]=t.useState(!1),[T,U]=t.useState({totalPackages:0,duplicateIds:{},duplicateCombinations:{},hasDuplicates:!1}),[R,L]=t.useState(""),[G,K]=t.useState(""),[J,q]=t.useState("myPackages");t.useEffect(()=>{(async()=>{try{(await fetch("/api/admin/admin-check",{credentials:"include"})).ok||l("/admin/login")}catch(e){l("/admin/login")}})()},[l]),t.useEffect(()=>{V()},[]),t.useEffect(()=>{z()},[k]);const V=async()=>{try{const e=await fetch("/api/admin/package-countries",{credentials:"include"});if(e.ok){const a=await e.json();"success"===a.status&&Array.isArray(a.data)}}catch(e){}},z=async()=>{try{x(!0),await Promise.all([H(),Q(1,5e4),V()])}catch(e){y("Failed to fetch data")}finally{x(!1)}},H=async()=>{try{x(!0);const e=await r("GET"),a=await fetch("/api/admin/my-packages",{headers:e,credentials:"include"});if(a.ok){const e=await a.json();d(e.data||e)}else{await a.text();y("Failed to fetch my packages")}}catch(e){y("Failed to fetch my packages")}finally{x(!1)}},Q=async(e=1,a=5e4)=>{try{h(!0);const e=await r("GET"),t=`/api/admin/all-roamify-packages?page=1&limit=${a}`,s=await fetch(t,{headers:e,credentials:"include"});if(s.ok){const e=await s.json();let a=[],t=null;if(e&&"object"==typeof e)if(Array.isArray(e))a=e;else{if(!e.data||!Array.isArray(e.data))return void y("Invalid response format from server");a=e.data,t=e.pagination}t&&N(t.page);const r=W(a);U(r),r.hasDuplicates&&(Object.entries(r.duplicateIds).forEach(([e,a])=>{}),Object.entries(r.duplicateCombinations).forEach(([e,a])=>{})),p(a)}else{const e=await s.text();y(`Failed to fetch Roamify packages: ${s.status} - ${e.substring(0,200)}`)}}catch(t){y("Failed to fetch Roamify packages")}finally{h(!1)}},W=e=>{if(!Array.isArray(e))return{totalPackages:0,duplicateIds:{},duplicateCombinations:{},hasDuplicates:!1};const a=e.length,t={},s={},r={};e.forEach(e=>{const a=e.id||e.packageId||"unknown";r[a]||(r[a]=[]),r[a].push(e)}),Object.entries(r).forEach(([e,a])=>{a.length>1&&(t[e]=a)});const i={};e.forEach(e=>{const a=`${e.country||e.country_name||"unknown"}|${e.data||e.dataAmount||"unknown"}|${e.days||e.day||"unknown"}|${e.price||e.base_price||"unknown"}`;i[a]||(i[a]=[]),i[a].push(e)}),Object.entries(i).forEach(([e,a])=>{a.length>1&&(s[e]=a)});const c=Object.keys(t).length>0||Object.keys(s).length>0;return{totalPackages:a,duplicateIds:t,duplicateCombinations:s,hasDuplicates:c}},X=async e=>{var a;j(e.id||e.packageId||"");try{const t=e.description||e.packageName||e.name||e.package||"Unknown Package",s=e.country||e.country_name||"",c=e.country_code||"";let l=e.data||e.dataAmount||"",n=0;if("number"==typeof l)n="MB"===e.dataUnit?l/1024:l;else if("string"==typeof l){const e=l.match(/(\d+(?:\.\d+)?)(GB|MB|KB)?/i);if(e){let t=parseFloat(e[1]);const s=(null==(a=e[2])?void 0:a.toUpperCase())||"GB";n="GB"===s?t:"MB"===s?t/1024:"KB"===s?t/1024/1024:t}}const d=e.days||e.day||0,o=e.price||e.base_price||0,p=F[e.id||e.packageId||""]??o.toString(),m=""===p?o:parseFloat(p),x=e.id||e.packageId||"",u=e.region||"";if(!(t&&s&&c&&n&&d&&o))return i.error("Cannot save: Missing required fields.",{style:{color:"black"}}),y("Cannot save: Missing required fields."),void j(null);const h={name:t,country_name:s,country_code:c,data_amount:n,days:d,base_price:o,sale_price:m,profit:m-o,reseller_id:null,region:u,show_on_frontend:!0,location_slug:"Europe & United States"===s?"":c.toLowerCase(),homepage_order:0,features:{packageId:x,dataAmount:n,days:d,price:o,currency:"EUR",plan:"data-only",activation:"first-use",realRoamifyPackageId:x}},g=await r("POST"),b=await fetch("/api/admin/save-package",{method:"POST",headers:g,credentials:"include",body:JSON.stringify(h)});if(b.ok)await H(),y(""),i.success('Package saved successfully! Use "Save as Most Popular" to show in Most Popular section.',{style:{color:"black"}});else{const e=`Failed to save package: ${(await b.json()).error||"Unknown error"}`;i.error(e,{style:{color:"black"}}),y(e)}}catch(t){const e="Failed to save package";i.error(e,{style:{color:"black"}}),y(e)}finally{j(null)}};return e.jsx("div",{className:"min-h-screen bg-[#4B0082] text-white",children:e.jsxs("div",{className:"max-w-full mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("header",{className:"glass-medium p-4 flex justify-between items-center rounded-b-2xl mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-200",children:"eSIM Package Management"})]}),e.jsx("button",{onClick:async()=>{await fetch("/api/logout",{method:"POST",credentials:"include"}),i.success("Logged out successfully",{style:{color:"black"}}),l("/admin/login")},className:"btn-glass bg-accent text-black px-4 py-2 rounded-xl",children:"Logout"})]}),g&&e.jsx("div",{className:"modal-glass p-4 rounded-2xl max-w-lg mx-auto mb-4 text-red-600 border border-red-400 bg-white",children:g}),e.jsxs("div",{className:"glass-light p-1 rounded-2xl mb-6 inline-flex",children:[e.jsxs("button",{onClick:()=>q("myPackages"),className:"px-6 py-3 rounded-xl font-medium transition-all "+("myPackages"===J?"bg-white/20 text-white shadow-lg":"text-gray-300 hover:text-white hover:bg-white/10"),children:["My eSIM Packages (",n.length,")"]}),e.jsxs("button",{onClick:()=>q("roamifyPackages"),className:"px-6 py-3 rounded-xl font-medium transition-all "+("roamifyPackages"===J?"bg-white/20 text-white shadow-lg":"text-gray-300 hover:text-white hover:bg-white/10"),children:["Roamify Packages (",o.length,")"]})]}),e.jsxs("div",{className:"w-full",children:["myPackages"===J&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"glass-light p-6 rounded-2xl shadow-none mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["My eSIM Packages Only (",n.length,")"]}),e.jsx("p",{className:"text-gray-200 mb-4",children:"Manage your eSIM packages with edit and delete functionality"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"my-packages-country-search",className:"block text-sm font-medium text-white",children:"Search by Country:"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("input",{type:"text",id:"my-packages-country-search",placeholder:"Search country...",value:R,onChange:e=>L(e.target.value),className:"input-glass w-full text-white placeholder-gray-300"}),R&&e.jsx("button",{onClick:()=>L(""),className:"btn-glass bg-white/20 text-white px-4 py-2 rounded-xl",children:"Clear"})]}),R&&e.jsxs("p",{className:"mt-1 text-sm text-gray-200",children:["Showing ",n.filter(e=>e.country_name.toLowerCase().includes(R.toLowerCase())).length," of ",n.length," packages"]})]}),m?e.jsx("div",{className:"text-center text-xl",children:"Loading packages..."}):e.jsx("div",{className:"glass p-4 rounded-2xl bg-black/20 w-full",children:e.jsx("div",{className:"overflow-auto max-h-[70vh]",children:e.jsxs("table",{className:"w-full text-left text-white bg-transparent table-auto",children:[e.jsx("thead",{className:"sticky top-0 bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[200px]",children:"Package"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[120px]",children:"Country"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Code"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Data"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[60px]",children:"Days"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Base Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Sale Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[70px]",children:"Profit"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[120px]",children:"Actions"})]})}),e.jsx("tbody",{children:n.filter(e=>!R||e.country_name.toLowerCase().includes(R.toLowerCase())).map(a=>e.jsxs("tr",{className:"hover:bg-white/5 border-b border-white/10 text-white",children:[e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap",children:[(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"text",value:S.name,onChange:e=>I({...S,name:e.target.value}),className:"w-48 px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white"}):e.jsx("div",{className:"text-sm font-medium text-white",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["ID: ",a.id]})]}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"text",value:S.country_name,onChange:e=>I({...S,country_name:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white"}):e.jsx("span",{className:"text-sm text-white",children:a.country_name})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"text",value:S.country_code||"",onChange:e=>I({...S,country_code:e.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white",placeholder:"e.g., DE"}):e.jsx("span",{className:"text-sm text-white",children:a.country_code||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"number",step:"0.1",value:S.data_amount.toFixed(1),onChange:e=>I({...S,data_amount:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-gray-900 bg-white",placeholder:"GB"}):e.jsxs("span",{className:"text-sm text-white",children:["number"!=typeof a.data_amount||isNaN(a.data_amount)?"0.0":a.data_amount.toFixed(1)," GB"]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"number",value:S.days,onChange:e=>I({...S,days:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-black bg-white"}):e.jsx("span",{className:"text-sm text-white",children:a.days})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"number",step:"0.01",value:S.base_price,onChange:e=>I({...S,base_price:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-black bg-white"}):e.jsxs("span",{className:"text-sm text-white",children:["$",a.base_price]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"number",step:"0.01",value:S.sale_price,onChange:e=>I({...S,sale_price:Number(e.target.value)}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm font-bold text-black bg-white"}):e.jsx("input",{type:"number",step:"0.01",value:a.sale_price,onChange:e=>((e,a)=>{const t=parseFloat(a)||0;d(a=>a.map(a=>a.id===e?{...a,sale_price:t,profit:t-a.base_price}:a))})(a.id,e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm font-bold text-black bg-white"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:(null==S?void 0:S.id)===a.id?e.jsx("input",{type:"number",step:"0.01",value:S.profit,readOnly:!0,className:"w-full px-2 py-1 border border-gray-300 rounded text-sm bg-gray-100 text-black"}):e.jsxs("span",{className:"text-sm "+(a.profit>0?"text-green-400":"text-red-400"),children:["$","number"!=typeof a.profit||isNaN(a.profit)?"0.00":a.profit.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium",children:(null==S?void 0:S.id)===a.id?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{w(!0);try{const a={...e,data_amount:e.data_amount},t=await r("PUT"),s=await fetch(`/api/admin/update-package/${e.id}`,{method:"PUT",headers:t,credentials:"include",body:JSON.stringify(a)});if(s.ok)await H(),I(null),y("");else{const e=await s.json();y(`Failed to save package: ${e.error||"Unknown error"}`)}}catch(a){y("Failed to save package")}finally{w(!1)}})(S),disabled:b,className:"text-blue-400 hover:text-blue-300 disabled:opacity-50",children:c(b?"saving":"save")}),e.jsx("button",{onClick:()=>I(null),className:"text-gray-400 hover:text-gray-300",children:c("cancel")})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{I(e)})(a),className:"text-blue-400 hover:text-blue-300",children:c("edit")}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this package?")){A(e);try{const a=await r("DELETE"),t=await fetch(`/api/admin/delete-package/${e}`,{method:"DELETE",headers:a,credentials:"include"});t.ok?(await H(),y("")):(await t.text(),y("Failed to delete package"))}catch(a){y("Failed to delete package")}finally{A(null)}}})(a.id),disabled:D===a.id,className:"text-red-400 hover:text-red-300 disabled:opacity-50",children:D===a.id?c("deleting"):c("delete")})]})})]},a.id))})]})})})]})}),"roamifyPackages"===J&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"glass-light p-6 rounded-2xl shadow-none mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["Roamify Packages (",o.length,")"]}),e.jsx("p",{className:"text-gray-200 mb-4",children:"Available packages from Roamify API - Edit sale price and save to your inventory"}),!u&&e.jsxs("div",{className:"mb-4 p-4 bg-white/10 rounded-lg border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-2",children:"Package Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Total Packages"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:T.totalPackages})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Duplicate IDs"}),e.jsx("div",{className:"text-2xl font-bold "+(T.hasDuplicates?"text-red-600":"text-green-600"),children:Object.keys(T.duplicateIds).length})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Duplicate Combinations"}),e.jsx("div",{className:"text-2xl font-bold "+(T.hasDuplicates?"text-red-600":"text-green-600"),children:Object.keys(T.duplicateCombinations).length})]})]}),T.hasDuplicates&&e.jsx("div",{className:"mt-4",children:e.jsxs("details",{className:"bg-white p-3 rounded border",children:[e.jsx("summary",{className:"cursor-pointer font-medium text-red-700 hover:text-red-800",children:"🔍 View Duplicate Details (Click to expand)"}),e.jsxs("div",{className:"mt-3 space-y-4",children:[Object.keys(T.duplicateIds).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Duplicate IDs:"}),e.jsx("div",{className:"space-y-2",children:Object.entries(T.duplicateIds).map(([a,t])=>e.jsxs("div",{className:"bg-red-50 p-2 rounded border-l-4 border-red-400",children:[e.jsxs("div",{className:"font-medium text-red-800",children:["ID: ",a," (appears ",t.length," times)"]}),t.map((a,t)=>e.jsxs("div",{className:"text-sm text-red-700 ml-4",children:[t+1,". ",a.description||a.packageName||a.name||a.package," - ",a.country||a.country_name," - ",a.data_amount||a.dataAmount||a.data," - ",a.days||a.day," days - $",a.base_price||a.price]},t))]},a))})]}),Object.keys(T.duplicateCombinations).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Duplicate Combinations (Country + Data + Days + Price):"}),e.jsx("div",{className:"space-y-2",children:Object.entries(T.duplicateCombinations).map(([a,t])=>e.jsxs("div",{className:"bg-orange-50 p-2 rounded border-l-4 border-orange-400",children:[e.jsxs("div",{className:"font-medium text-orange-800",children:["Combination: ",a," (appears ",t.length," times)"]}),t.map((a,t)=>e.jsxs("div",{className:"text-sm text-orange-700 ml-4",children:[t+1,". ID: ",a.id||a.packageId," - ",a.description||a.packageName||a.name||a.package]},t))]},a))})]})]})]})})]}),!u&&T.hasDuplicates&&e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"📋 Duplicate Indicators Legend:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-50 border-l-4 border-red-400 mr-2"}),e.jsx("span",{className:"text-yellow-700",children:"Red background = Duplicate package"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mr-2",children:"Duplicate ID"}),e.jsx("span",{className:"text-yellow-700",children:"Same package ID appears multiple times"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mr-2",children:"Duplicate Combo"}),e.jsx("span",{className:"text-yellow-700",children:"Same country + data + days + price combination"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"country-filter",className:"block text-sm font-medium text-white",children:"Filter by Country:"}),e.jsx("input",{type:"text",placeholder:"Search country...",value:G,onChange:e=>K(e.target.value),className:"mt-1 mb-2 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md text-gray-900 bg-white"}),e.jsxs("select",{id:"country-filter",value:v,onChange:e=>_(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md text-gray-900 bg-white",children:[e.jsxs("option",{value:"",children:["All Countries (",C.length,")"]}),C.filter(e=>!!e&&e.toLowerCase().includes(G.toLowerCase())).map(a=>e.jsx("option",{value:a,children:a},a))]})]}),!u&&T.hasDuplicates&&e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:async()=>{if(T.hasDuplicates){E(!0);try{const e=await r("POST"),a=await fetch("/api/admin/deduplicate-packages",{method:"POST",headers:e,credentials:"include"});if(a.ok){const e=await a.json();i.success(`Successfully removed ${e.removedCount} duplicate packages`,{style:{color:"black"}}),await Q()}else{const e=await a.json();i.error(`Failed to remove duplicates: ${e.error||"Unknown error"}`,{style:{color:"black"}})}}catch(e){i.error("Failed to remove duplicates",{style:{color:"black"}})}finally{E(!1)}}else i.info("No duplicates found to remove",{style:{color:"black"}})},disabled:$,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Removing Duplicates..."]}):e.jsxs(e.Fragment,{children:["🗑️ Remove Duplicates",e.jsxs("span",{className:"text-xs bg-red-700 px-2 py-1 rounded",children:[Object.keys(T.duplicateIds).length+Object.keys(T.duplicateCombinations).length," groups"]})]})}),e.jsx("p",{className:"mt-1 text-sm text-gray-300",children:"This will remove duplicate packages based on ID and combination matches"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:async()=>{M(!0);try{const e=await r("POST"),a=await fetch("/api/sync/roamify-packages",{method:"POST",headers:e,credentials:"include"});if(a.ok){const e=await a.json();i.success(`Successfully synced ${e.syncedCount} packages from Roamify API (${e.countries} countries)`,{style:{color:"black"}}),await Q()}else{const e=await a.json();i.error(`Failed to sync packages: ${e.message||"Unknown error"}`,{style:{color:"black"}})}}catch(e){i.error("Failed to sync packages",{style:{color:"black"}})}finally{M(!1)}},disabled:B,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Syncing from Roamify API..."]}):e.jsx(e.Fragment,{children:"🔄 Sync from Roamify API"})}),e.jsx("p",{className:"mt-1 text-sm text-gray-300",children:"This will fetch fresh data directly from Roamify API and sync to database"})]}),u?e.jsx("div",{className:"text-center text-xl text-white mt-8",children:"Loading Roamify packages..."}):0===o.length?e.jsxs("div",{className:"text-center text-xl text-white mt-8",children:[e.jsx("p",{children:"No packages loaded from database."}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:'Click "Sync from Roamify API" to fetch packages.'})]}):0===P.length?e.jsxs("div",{className:"text-center text-xl text-white mt-8",children:[e.jsxs("p",{children:['No packages found for country: "',v,'"']}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:'Try selecting "All Countries" or a different country.'})]}):e.jsx("div",{className:"glass p-4 rounded-2xl bg-black/20 mt-6 w-full",children:e.jsx("div",{className:"overflow-auto max-h-[70vh]",children:e.jsxs("table",{className:"w-full text-left text-white bg-transparent table-auto",children:[e.jsx("thead",{className:"sticky top-0 bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[200px]",children:"Package"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[120px]",children:"Country"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Code"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Data"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[60px]",children:"Days"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Base Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[80px]",children:"Sale Price"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[70px]",children:"Profit"}),e.jsx("th",{className:"border-b border-white/20 px-3 py-3 text-xs font-medium uppercase tracking-wider min-w-[150px]",children:"Actions"})]})}),e.jsx("tbody",{children:P.map(a=>{const t=a.id||a.packageId||"",s=t?T.duplicateIds[t]:void 0,c=`${a.country||a.country_name||"unknown"}|${a.data||a.dataAmount||"unknown"}|${a.days||a.day||"unknown"}|${a.price||a.base_price||"unknown"}`,l=c?T.duplicateCombinations[c]:void 0;return e.jsxs("tr",{className:"hover:bg-white/5 border-b border-white/10 text-white "+(s||l?"bg-red-900/20":""),children:[e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:a.description||a.packageName||a.name||a.package||"Unknown Package"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["ID: ",a.id||a.packageId||"N/A"]}),s&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mt-1",children:"Duplicate ID"}),l&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800 mt-1",children:"Duplicate Combo"})]}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:a.country||a.country_name||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:a.country_code||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm text-white",children:[a.data||("number"==typeof a.dataAmount?a.dataAmount.toFixed(1):"N/A")," GB"]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:a.days||a.day||"N/A"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm text-white",children:["$",a.price||a.base_price||"0.00"]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",step:"0.01",value:F[a.id||a.packageId||""]||"",onChange:e=>O(t=>({...t,[a.id||a.packageId||""]:e.target.value})),placeholder:(a.price||a.base_price||0).toString(),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm font-bold text-black bg-white"})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm "+(parseFloat(F[a.id||a.packageId||""]||"0")-(a.price||a.base_price||0)>0?"text-green-400":"text-red-400"),children:["$",((parseFloat(F[a.id||a.packageId||""]||"0")||a.price||a.base_price||0)-(a.price||a.base_price||0)).toFixed(2)]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>X(a),disabled:f===(a.id||a.packageId),className:"text-blue-400 hover:text-blue-300 disabled:opacity-50",children:f===(a.id||a.packageId)?"Saving...":"Save"}),e.jsx("button",{onClick:()=>(async e=>{var a;j(e.id||e.packageId||"");try{if("Europe & United States"!==e.country)return i.error("Only Europe & United States packages can be saved as Most Popular. This package will be saved to its country-specific page instead.",{style:{color:"black"}}),void(await X(e));const t=e.price||e.base_price||0,s=F[e.id||e.packageId||""]??t.toString(),c=""===s?t:parseFloat(s);let l=e.data||e.dataAmount||"",n=0;if("number"==typeof l)n="MB"===e.dataUnit?l/1024:l;else if("string"==typeof l){const e=l.match(/(\d+(?:\.\d+)?)(GB|MB|KB)?/i);if(e){let t=parseFloat(e[1]);const s=(null==(a=e[2])?void 0:a.toUpperCase())||"GB";n="GB"===s?t:"MB"===s?t/1024:"KB"===s?t/1024/1024:t}}const d={name:e.description||e.packageName||e.name||e.package||"Unknown Package",country_name:e.country||e.country_name||"",country_code:e.country_code||"",data_amount:n,days:e.days||e.day||0,base_price:t,sale_price:c,profit:c-t,reseller_id:null,region:e.region||"",show_on_frontend:!0,location_slug:"most-popular",homepage_order:1,features:{packageId:e.id||e.packageId||"",dataAmount:n,days:e.days||e.day||0,price:t,currency:"EUR",plan:"data-only",activation:"first-use",realRoamifyPackageId:e.id||e.packageId||""}},o=await r("POST"),p=await fetch("/api/admin/save-package",{method:"POST",headers:o,credentials:"include",body:JSON.stringify(d)});if(p.ok)await H(),y(""),i.success("Package saved to Most Popular section successfully!",{style:{color:"black"}});else{const e=`Failed to save package: ${(await p.json()).error||"Unknown error"}`;i.error(e,{style:{color:"black"}}),y(e)}}catch(t){const e="Failed to save package";i.error(e,{style:{color:"black"}}),y(e)}finally{j(null)}})(a),disabled:f===(a.id||a.packageId),className:"text-green-400 hover:text-green-300 disabled:opacity-50",children:"Save as Most Popular"})]})})]},a.id||a.packageId)})})]})})})]})})]})]})})};export{c as default};
