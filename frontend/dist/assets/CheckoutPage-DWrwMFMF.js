import{j as e}from"./ui-B6UisXh3.js";import{r as t,e as r,f as s,b as a}from"./router-DECodpxX.js";import{c as l,u as n,t as o,H as i}from"./index-C7QPt96S.js";import{u as c,a as d,C as u,b as m,c as x,E as p,l as h}from"./stripe-mM_JmaPQ.js";import{e as b}from"./countries-CY_OT5aH.js";import{f as g}from"./formatDataAmount-BZyhGwR3.js";import{o as f,s as y}from"./types-G7CTAjld.js";import"./vendor-DEQ385Nk.js";import"./three-CdCYxwFx.js";import"./supabase-Bj79fh9f.js";import"./utils-BpqZfnrR.js";
/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=l("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),w=t.forwardRef(({amount:r,currency:s,email:a,packageId:l,name:i,surname:p,phone:h,country:b,onSuccess:g,onError:f},y)=>{const j=a??"",{t:w}=n(),v=c(),N=d(),[k,_]=t.useState(!1),[S,C]=t.useState(null),E=async e=>{if(!v||!N)return o({title:"Stripe Error",description:"Stripe has not loaded yet. Please try again.",variant:"destructive"}),void f("Stripe has not loaded yet. Please try again.");_(!0);try{let e=S;if(!e){if(e=await(async()=>{try{const e=await fetch("undefined/api/payments/create-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:r,currency:s,email:j,packageId:l,name:i??"",surname:p??"",phone:h??"",country:b??""})});if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.message||`HTTP ${e.status}: ${e.statusText}`)}const t=await e.json();if("success"===t.status)return t.data.clientSecret;throw new Error(t.message||"Failed to create payment intent")}catch(c){throw c}})(),!e)throw new Error("Failed to create payment intent: No client secret received");C(e)}const t=N.getElement(u),a=N.getElement(m),n=N.getElement(x);if(!t||!a||!n)throw o({title:"Card Error",description:"Card elements not found",variant:"destructive"}),new Error("Card elements not found");const{error:c,paymentIntent:d}=await v.confirmCardPayment(e,{payment_method:{card:t,billing_details:{email:j||""}}});c?(o({title:w("payment_failed"),description:c.message||"There was an error processing your payment.",variant:"destructive"}),f(c.message||"There was an error processing your payment.")):d&&"succeeded"===d.status?(o({title:w("payment_successful"),description:w("payment_processed_successfully"),variant:"default"}),g(d.id)):(o({title:w("payment_failed"),description:"Payment was not successful. Please try again.",variant:"destructive"}),f("Payment was not successful. Please try again."))}catch(t){const e=t instanceof Error?t.message:"There was an error processing your payment.";o({title:w("payment_failed"),description:e,variant:"destructive"}),f(e)}finally{_(!1)}};return t.useImperativeHandle(y,()=>({submit:async()=>{await E()}})),e.jsxs("div",{className:"bg-gray-50 border-2 border-gray-200 shadow-md rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("img",{src:"/images/payment-cards/visa-logo.webp",alt:"Visa",className:"h-8"}),e.jsx("img",{src:"/images/payment-cards/mastercard-logo.webp",alt:"Mastercard",className:"h-8"}),e.jsx("img",{src:"/images/payment-cards/amex-logo.webp",alt:"Amex",className:"h-8"}),e.jsx("span",{className:"ml-2 bg-gray-300 text-gray-700 text-xs px-3 py-1 rounded-full border",children:"+1"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:w("card_number")}),e.jsx("div",{className:"w-full border-2 border-gray-300 rounded-lg px-4 py-3 bg-white shadow-sm focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-all",children:e.jsx(u,{options:{style:{base:{fontSize:"17px",color:"#222","::placeholder":{color:"#bbb"},fontFamily:"inherit",backgroundColor:"transparent"},invalid:{color:"#ff4444"}}},className:"flex-1 bg-transparent outline-none text-lg h-full"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:w("expiry")}),e.jsx("div",{className:"w-full border-2 border-gray-300 rounded-lg px-4 py-3 bg-white shadow-sm focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-all",children:e.jsx(m,{options:{style:{base:{fontSize:"17px",color:"#222","::placeholder":{color:"#bbb"},fontFamily:"inherit",backgroundColor:"transparent"},invalid:{color:"#ff4444"}}},className:"flex-1 bg-transparent outline-none text-lg h-full"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:w("cvc")}),e.jsx("div",{className:"w-full border-2 border-gray-300 rounded-lg px-4 py-3 bg-white shadow-sm focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-all",children:e.jsx(x,{options:{style:{base:{fontSize:"17px",color:"#222","::placeholder":{color:"#bbb"},fontFamily:"inherit",backgroundColor:"transparent"},invalid:{color:"#ff4444"}}},className:"flex-1 bg-transparent outline-none text-lg h-full"})})]})]})]})]})}),v=h(void 0);class N extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Unexpected Error"}),e.jsx("p",{className:"text-gray-600",children:"Something went wrong. Please try again or contact support."})]}),e.jsx("button",{onClick:()=>window.location.href="/packages",className:"w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:"Browse Packages"})]})}):this.props.children}}const k=f({email:y().email("Please enter a valid email"),name:y().min(1,"First name is required"),surname:y().min(1,"Last name is required"),phone:y().min(7,"Phone is required"),country:y().min(1,"Country is required")}),_=()=>{const{t:a,language:l,setLanguage:c}=n(),d=r(),[u]=s(),[m,x]=t.useState(""),[h,f]=t.useState(""),[y,_]=t.useState(""),[S,C]=t.useState(""),[E,P]=t.useState(""),[L,F]=t.useState(null),[I,T]=t.useState(""),[M,z]=t.useState(!1),[B,H]=t.useState(0),[q,A]=t.useState(!0),[D,W]=t.useState(null),R=t.useRef(null),[$,O]=t.useState(null),J=u.get("packageId")||u.get("package");t.useEffect(()=>{J&&!D&&(W(J),localStorage.setItem("checkout_package_id",J))},[J,D]);const U=J||D||localStorage.getItem("checkout_package_id");t.useEffect(()=>{U?(async()=>{try{const e=await fetch(`/api/frontend-packages?lang=${l}`),t=(await e.json()).find(e=>e.id===U);t?F(t):(o({title:a("package_not_found"),description:a("selected_package_not_found"),variant:"destructive"}),d("/packages"))}catch(e){o({title:a("error"),description:a("failed_to_load_package_details"),variant:"destructive"})}finally{A(!1)}})():A(!1)},[U,l,d,a]);if(t.useEffect(()=>()=>{window.location.pathname.includes("/checkout/success")||localStorage.removeItem("checkout_package_id")},[]),t.useEffect(()=>{"al"!==l&&c("al")},[l,c]),q)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"})});if(!U)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a("no_package_selected")}),e.jsx("p",{className:"text-gray-600",children:a("please_select_package_first")})]}),e.jsx("button",{onClick:()=>d("/packages"),className:"w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:a("browse_packages")})]})});if(!L)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a("package_not_found")}),e.jsx("p",{className:"text-gray-600",children:a("selected_package_not_found")})]}),e.jsx("button",{onClick:()=>d("/packages"),className:"w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:a("browse_packages")})]})});const V=Math.max(0,L.sale_price-B);return e.jsx(N,{children:e.jsxs("div",{className:"checkout-page min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs(i,{children:[e.jsxs("title",{children:[a("checkout")," - eSIMFly"]}),e.jsx("meta",{name:"description",content:a("checkout_description")})]}),e.jsx("div",{className:"w-full bg-gradient-to-r from-blue-50 via-white to-purple-50 border-b-2 border-gray-200 px-4 py-4 shadow-sm",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center",children:[e.jsxs("button",{onClick:()=>d(-1),className:"flex items-center gap-2 px-6 py-3 border-2 border-blue-500 text-blue-700 bg-white hover:bg-blue-50 hover:text-blue-900 rounded-lg transition-colors font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2",style:{boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 flex-1 text-center",children:"Checkout"}),e.jsx("div",{className:"w-[120px]"})," "]})}),e.jsx("div",{className:"flex-1 w-full min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex flex-col justify-center py-8",children:e.jsxs("div",{className:"flex flex-1 flex-col md:flex-row max-w-5xl mx-auto w-full py-6 md:py-12 gap-6 md:gap-8 px-4 md:px-0",children:[e.jsx("div",{className:"flex-1 flex flex-col justify-between",children:e.jsxs("form",{className:"bg-white/90 rounded-2xl shadow-2xl border border-blue-100 p-6 md:p-10 flex flex-col gap-8",onSubmit:async e=>{e.preventDefault(),O(null);const t=k.safeParse({email:y,name:S,surname:E,phone:h,country:m});t.success?R.current&&await R.current.submit():O(t.error.errors[0].message)},style:{boxShadow:"0 8px 32px rgba(80,80,180,0.08)"},children:[$&&e.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded-lg mb-2 text-center font-semibold",children:$}),e.jsxs("div",{className:"border-b border-blue-100 pb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 border-l-4 border-blue-600 pl-4",children:"Credit card"}),e.jsx(p,{stripe:v,children:e.jsx(w,{ref:R,amount:V,currency:"eur",email:y,packageId:L.id,name:S,surname:E,phone:h,country:m,onSuccess:e=>{localStorage.removeItem("checkout_package_id"),d("/checkout/success?payment_intent_id="+e)},onError:e=>{o({title:a("payment_failed"),description:e,variant:"destructive"})}})})]}),e.jsxs("div",{className:"border-b border-blue-100 pb-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4 text-gray-900 border-l-4 border-green-600 pl-4",children:"Billing address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:y,onChange:e=>_(e.target.value),placeholder:"Enter your email",className:"w-full px-4 py-3 border-2 border-blue-100 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country/Region"}),e.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 border-2 border-blue-100 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white/80",children:[e.jsx("option",{value:"",children:"Select your country"}),b.map(t=>e.jsxs("option",{value:t.code,children:[t.name.en," ","AL"===t.code?"(Albania)":""," - ",t.code]},t.code))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First name *"}),e.jsx("input",{type:"text",value:S,onChange:e=>C(e.target.value),placeholder:"First name",className:"w-full px-4 py-3 border-2 border-blue-100 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last name *"}),e.jsx("input",{type:"text",value:E,onChange:e=>P(e.target.value),placeholder:"Last name",className:"w-full px-4 py-3 border-2 border-blue-100 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white/80"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),e.jsx("input",{type:"tel",value:h,onChange:e=>f(e.target.value),placeholder:"Phone",className:"w-full px-4 py-3 border-2 border-blue-100 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors bg-white/80"})]})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-4 rounded-xl font-bold text-lg border-2 border-blue-600 hover:border-purple-700 shadow-lg transition-all duration-200 transform hover:scale-105",children:"Pay now"})]})}),e.jsxs("div",{className:"w-full md:w-96 flex flex-col gap-6",children:[e.jsx("div",{className:"bg-white/90 border-2 border-blue-100 rounded-2xl shadow-2xl p-4 flex justify-center items-center",style:{boxShadow:"0 8px 32px rgba(80,80,180,0.08)"},children:e.jsxs("picture",{children:[e.jsx("source",{srcSet:"/optimized/pandahero4.webp",type:"image/webp"}),e.jsx("img",{src:"/optimized/pandahero4.jpg",alt:"e-SimFly Travel Experience",className:"w-full h-48 md:h-56 object-cover rounded-xl shadow-lg",style:{maxWidth:"100%",maxHeight:"224px"}})]})}),e.jsxs("div",{className:"bg-white/90 border-2 border-blue-100 rounded-2xl shadow-2xl p-6 flex flex-col justify-center items-center",style:{boxShadow:"0 8px 32px rgba(80,80,180,0.08)"},children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900 border-b-2 border-blue-100 pb-3 w-full text-center",children:"Përmbledhje Porosie"}),e.jsx("div",{className:"w-full mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-2",children:"Package:"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[g(L.data_amount)," - ",L.days," days - ","object"==typeof L.country_name?L.country_name.en:L.country_name]})]})}),e.jsxs("div",{className:"flex flex-col justify-center items-center w-full",children:[e.jsx("span",{className:"font-bold text-xl text-gray-900 mb-2",children:"Totali"}),e.jsxs("span",{className:"font-bold text-3xl text-blue-600",children:["€","number"!=typeof V||isNaN(V)?"0.00":V.toFixed(2)]})]})]})]})]})})]})})};export{_ as default};
